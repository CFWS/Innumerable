// https://github.com/taylorhakes/promise-polyfill
// Licensed under MIT
!function(r){function n(r,o){return function(){r.apply(o,arguments)}}function e(r){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof r)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],c(r,n(u,this),n(l,this))}function i(r){var n=this;return null===this._state?void this._deferreds.push(r):void o(function(){var o=n._state?r.onFulfilled:r.onRejected;if(null===o)return void(n._state?r.resolve:r.reject)(n._value);var t;try{t=o(n._value)}catch(e){return void r.reject(e)}r.resolve(t)})}function u(r){try{if(r===this)throw new TypeError("A promise cannot be resolved with itself.");if(r&&("object"==typeof r||"function"==typeof r)){var o=r.then;if("function"==typeof o)return void c(n(o,r),n(u,this),n(l,this))}this._state=!0,this._value=r,s.call(this)}catch(t){l.call(this,t)}}function l(r){this._state=!1,this._value=r,s.call(this)}function s(){for(var r=0,o=this._deferreds.length;o>r;r++)i.call(this,this._deferreds[r]);this._deferreds=null}function a(r,o,n,t){this.onFulfilled="function"==typeof r?r:null,this.onRejected="function"==typeof o?o:null,this.resolve=n,this.reject=t}function c(r,o,n){var t=!1;try{r(function(r){t||(t=!0,o(r))},function(r){t||(t=!0,n(r))})}catch(e){if(t)return;t=!0,n(e)}}var o="function"==typeof setImmediate&&setImmediate||function(r){setTimeout(r,1)},t=Array.isArray||function(r){return"[object Array]"===Object.prototype.toString.call(r)};e.prototype["catch"]=function(r){return this.then(null,r)},e.prototype.then=function(r,o){var n=this;return new e(function(t,e){i.call(n,new a(r,o,t,e))})},e.all=function(){var r=Array.prototype.slice.call(1===arguments.length&&t(arguments[0])?arguments[0]:arguments);return new e(function(o,n){function e(i,u){try{if(u&&("object"==typeof u||"function"==typeof u)){var l=u.then;if("function"==typeof l)return void l.call(u,function(r){e(i,r)},n)}r[i]=u,0===--t&&o(r)}catch(s){n(s)}}if(0===r.length)return o([]);for(var t=r.length,i=0;i<r.length;i++)e(i,r[i])})},e.resolve=function(r){return r&&"object"==typeof r&&r.constructor===e?r:new e(function(o){o(r)})},e.reject=function(r){return new e(function(o,n){n(r)})},e.race=function(r){return new e(function(o,n){for(var t=0,e=r.length;e>t;t++)r[t].then(o,n)})},e._setImmediateFn=function(r){o=r},"undefined"!=typeof module&&module.exports?module.exports=e:r.Promise||(r.Promise=e)}(this);